"""V1.5.0: 新增混码规划结果表 planning_result

Revision ID: a726a57f1190
Revises: d9fca3ded8fc
Create Date: 2022-10-25 09:51:58.676705

"""
from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision = "a726a57f1190"
down_revision = "d9fca3ded8fc"
branch_labels = None
depends_on = None


def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table(
        "planning_result",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("order_id", sa.String(length=100), nullable=False, comment="订单ID"),
        sa.Column(
            "status",
            sa.Enum("PENDING", "PLANNING", "FINISHED", "FAIL", name="planningstatus"),
            nullable=False,
            comment="规划状态",
        ),
        sa.Column("result", sa.JSON(), nullable=True, comment="规划结果"),
        sa.Column("start_time", sa.DateTime(), nullable=True, comment="开始规划的时间"),
        sa.Column("end_time", sa.DateTime(), nullable=True, comment="结束的时间"),
        sa.Column(
            "create_time",
            sa.DateTime(),
            server_default=sa.text('CURRENT_TIMESTAMP'),
            nullable=False,
            comment="创建时间",
        ),
        sa.Column(
            "update_time",
            sa.DateTime(),
            server_default=sa.text('CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP'),
            nullable=False,
            comment="更新时间"
        ),
        sa.Column("is_deleted", sa.BOOLEAN(), nullable=True, comment="是否已删除"),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("order_id", "is_deleted", name="uniq_order_is_del"),
    )
    # ### end Alembic commands ###


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_table("planning_result")
    # ### end Alembic commands ###
